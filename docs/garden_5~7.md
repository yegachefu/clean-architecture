## 05. 웹 어댑터 구현하기
목표: 책에서 학습하고자 하는 아키텍처에서는 외부 세계와의 모든 커뮤니케이션은 어댑터를 통해 이뤄질 수 있도록 함  

### 웹 어댑터의 책임
 - HTTP 요청을 자바 객체로 매핑
 - 권한 검사
 - 입력 유효성 검증
 - 입력을 유스케이스의 입력 모델로 매핑
 - 유스케이스 호출
 - 유스케이스의 출력을 HTTP로 매핑
 - HTTP 응답을 반환
> 입력 유효성은 유스케이스 입력 모델의 책임이지만 웹 어댑터의 입력 모델은 웹 어댑터의 책임이다.  
> 웹 어댑터에서의 입력 유효성 검증은 -> 웹 어댑터의 입력 모델을 유스케이스의 입력 모델로 변환할 수 있다는 것을 검증해야 한다.

**HTTP와 관련된 것은 애플리케이션 계층으로 침투해서는 안 된다.**

### 컨트롤러 나누기  
웹 어댑터는 한 개 이상의 클래스로 구성해도 좋지만 같은 소속을 표현하기위해 같은 패키지 수전에 놓아야 한다.  
너무 적은 것보다 많은 컨트롤러를 만드는게 낫다.  
웹 컨트롤러를 나눌 때는 모델을 공유하지 않는 여러 작은 클래스들로 만들어야 한다.  
작은 클래스들은 더 파악하기 쉽고, 더 테스트하기 쉬우며, 동시 작업을 지원한다. (여러 명의 개발자가 병합 출동없이 작업이 가능하다는 의미 인듯)  
그래서 유지 보수 측면에서도 좋아 보인다.

## 06. 영속성 어댑터 구현하기
영속성 어댑터 구현의 핵심 기술은 의존성 역전  
서비스에서 데이터 영속화를 위해서 영속성 어댑터를 소유하게 되면  
유스케이스 계층(어플리케이션 계층, 서비스 계층) 에서 영속성 어댑터의 의존이 생기게 된다.  
영속성 어댑터를 영속성 계층에 그대로 두면서 서비스에서 영속성 어댑터를 이용하기 위해  
서비스 계층에 out 포트 인터페이스를 두고 영속성 어댑터에서 이를 구현한다.  
  
### 영속성 어댑터의 책임
 - 입력을 받는다
 - 입력을 데이터베이스 포맷으로 매핑한다
 - 입력을 데이터베이스로 보낸다
 - 데이터베이스 출력을 애플리케이션 포맷으로 매핑한다
 - 출력을 반환한다

**영속성 어댑터의 입출력 모델이 영속성 어댑터 내부가 아니라 애플리케이션 코어에 두어서 영속성 어댑터 내부를 변경하는 것이 코어에 영향을 미치지 않게 하는것이 핵심**

### 포트 인터페이스 나누기
넓은 포트 인터페이스를 만들지 말라! -> 서비스의 포트 인터페이스에 대한 불필요한 의존도가 생겨난다.  
인터페이스 분리 원칙을 이용해서 저수준의 특화된 인터페이스로 분리하는게 좋다.  
예시로 하나의 AccountRepository 인터페이스를 두기 보다는 LoadAccountPort, UpdateAccountStatePort, CreateAccountPort 이런식으로 Account  
엔티티에 필요한 데이터만 연산하는 여러 인터페이스를 둔다.  
  
### 영속성 어댑터 나누기
영속성 포트를 구현하는 하나의 영속성 어댑터만 둘 필요도 없다.  
경우에 따라서는 영속성 연산이 필요한 도메인 클래스에서 '애그리거트' 하나당 하나의 영속성 어댑터를 구현하는 방식을 선택할 수도 있다.  
'애그리거트당 하나의 영속성 어댑터' 접근 방식의 추가적인 장점으로는 추후 여러개의 바운디드 컨텍스트를 명확하게 하는 좋은 기준이 된다.  
**바운디드 컨텍스트 간의 경계를 명확하게 구분하고 싶다면 각 바운디드 컨텍스트가 영속성 어댑터(들)을 하나씩 가지고 있어야 한다.**

### 트랜잭션은 유스케이스 단위로 진행하는게 바람직함 (유스케이스에 대한 롤백 일관성을 확보)

좁은 포트 인터페이스를 사용하면 포트 뒤에서 애플리케이션이 모르게 다른 영속성 기술을 사용할 수도 있고,  
포트의 명세만 지켜진다면 영속성 계층 전체를 교체할 수 있는 유연함을 갖게 된다.

## 07. 아키텍처 요소 테스트하기
 - 도메인 엔티티를 구현할 때는 단위 테스트로 커버
 - 유스케이스를 구현할 때는 단위 테스트로 커버
 - 어댑터를 구현할 때는 통합 테스트로 커버
 - 사용자가 취할 수 있는 중요 애플리케이션 경로는 시스템 테스트로 커버